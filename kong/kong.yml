_format_version: "3.0"

plugins:
  - name: cors
    config:
      origins:
        - "http://localhost:3000"
        - "http://127.0.0.1:3000"
      methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
        - PATCH
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
        - Authorization
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600

services:
  - name: auth-service
    url: http://auth-service:8010
    routes:
      - name: auth
        paths:
          - /api/auth
        strip_path: true
        path_handling: v0

  - name: user-service
    url: http://user-service:8011/users
    routes:
      - name: users
        paths:
          - /api/users
        strip_path: true
        path_handling: v0

  - name: user-stats-service
    url: http://user-service:8011/stats
    routes:
      - name: users-stats
        paths:
          - /api/users/stats
        strip_path: true
        path_handling: v0

  - name: department-service
    url: http://department-service:8012/departments
    routes:
      - name: departments
        paths:
          - /api/departments
        strip_path: true
        path_handling: v0
      - name: classes
        paths:
          - /api/classes
        strip_path: true
        path_handling: v0
      - name: subjects
        paths:
          - /api/subjects
        strip_path: true
        path_handling: v0
      - name: cos
        paths:
          - /api/cos
        strip_path: true
        path_handling: v0
      - name: pos
        paths:
          - /api/pos
        strip_path: true
        path_handling: v0
      - name: co-po-mappings
        paths:
          - /api/co-po-mappings
        strip_path: true
        path_handling: v0

  - name: exam-service
    url: http://exam-service:8013
    routes:
      - name: exams
        paths:
          - /api/exams
        strip_path: true
        path_handling: v0
      - name: questions
        paths:
          - /api/questions
        strip_path: true
        path_handling: v0
      - name: questions-enhanced
        paths:
          - /api/questions/enhanced
        strip_path: true
        path_handling: v0
      - name: exam-sections
        paths:
          - /api/exam-sections
        strip_path: true
        path_handling: v0

  - name: marks-service
    url: http://marks-service:8014/marks
    routes:
      - name: marks
        paths:
          - /api/marks
        strip_path: true
        path_handling: v0
      - name: marks-template
        paths:
          - /api/marks/*/template
        strip_path: true
        path_handling: v0

  - name: analytics-dashboard-stats-service
    url: http://analytics-service:8015/dashboard-stats
    routes:
      - name: analytics-dashboard-stats
        paths:
          - /api/analytics/dashboard-stats
        strip_path: true
        path_handling: v0

  - name: analytics-co-attainment-service
    url: http://analytics-service:8015/co-attainment
    routes:
      - name: analytics-co-attainment
        paths:
          - /api/analytics/co-attainment
        strip_path: true
        path_handling: v0

  - name: analytics-po-attainment-service
    url: http://analytics-service:8015/po-attainment
    routes:
      - name: analytics-po-attainment
        paths:
          - /api/analytics/po-attainment
        strip_path: true
        path_handling: v0

  - name: analytics-student-performance-service
    url: http://analytics-service:8015/student-performance
    routes:
      - name: analytics-student-performance
        paths:
          - /api/analytics/student-performance
        strip_path: true
        path_handling: v0

  - name: analytics-service
    url: http://analytics-service:8015
    routes:
      - name: analytics
        paths:
          - /api/analytics
        strip_path: true
        path_handling: v0

  - name: bulk-service
    url: http://bulk-service:8016
    routes:
      - name: bulk
        paths:
          - /api/bulk
        strip_path: true
        path_handling: v0

  - name: export-service
    url: http://export-service:8017
    routes:
      - name: export-users
        paths:
          - /api/exports/users/csv
        strip_path: false
        path_handling: v0
      - name: export-marks
        paths:
          - /api/exports/marks
        strip_path: true
        path_handling: v0
      - name: export-analytics
        paths:
          - /api/exports/analytics
        strip_path: true
        path_handling: v0
      - name: export-co-attainment
        paths:
          - /api/exports/co-attainment
        strip_path: true
        path_handling: v0
      - name: export-comprehensive-report
        paths:
          - /api/exports/comprehensive-report
        strip_path: true
        path_handling: v0
      - name: export-reports
        paths:
          - /api/exports/reports
        strip_path: true
        path_handling: v0

  - name: notification-service
    url: http://notification-service:8018/notifications
    routes:
      - name: notifications
        paths:
          - /api/notifications
        strip_path: true
        path_handling: v0
      - name: notifications-ws
        paths:
          - /api/notifications/ws
        strip_path: true
        path_handling: v0

  - name: file-service
    url: http://file-service:8019
    routes:
      - name: files
        paths:
          - /api/files
        strip_path: true
        path_handling: v0
      - name: files-download
        paths:
          - /api/files/*/download
        strip_path: true
        path_handling: v0
      - name: files-preview
        paths:
          - /api/files/*/preview
        strip_path: true
        path_handling: v0

  - name: questionbank-service
    url: http://questionbank-service:8020
    routes:
      - name: questionbank
        paths:
          - /api/questionbank
        strip_path: true
        path_handling: v0
      - name: questionbank-stats
        paths:
          - /api/questionbank/*/stats
        strip_path: true
        path_handling: v0

  - name: monitoring-health-service
    url: http://monitoring-service:8021/health
    routes:
      - name: monitoring-health
        paths:
          - /api/monitoring/health
        strip_path: true
        path_handling: v0

  - name: monitoring-metrics-service
    url: http://monitoring-service:8021/metrics
    routes:
      - name: monitoring-metrics
        paths:
          - /api/monitoring/metrics
        strip_path: true
        path_handling: v0

  - name: monitoring-alerts-service
    url: http://monitoring-service:8021/alerts
    routes:
      - name: monitoring-alerts
        paths:
          - /api/monitoring/alerts
        strip_path: true
        path_handling: v0

  - name: monitoring-service
    url: http://monitoring-service:8021
    routes:
      - name: monitoring
        paths:
          - /api/monitoring
        strip_path: true
        path_handling: v0